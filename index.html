<section id="referrals" class="referral-section" aria-label="Реферальные программы и партнерские предложения">
  <style>
    /* Существующие стили остаются без изменений */
    /* Добавляем новые стили для плавной прокрутки */
    html {
      scroll-behavior: smooth;
    }
    
    .category-anchor {
      scroll-margin-top: 20px;
    }
  </style>

  <!-- Остальная разметка остается без изменений до скрипта -->

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "ItemList",
      "name": "Реферальные программы и специальные предложения",
      "description": "Лучшие реферальные предложения от банков, сервисов доставки и криптобирж с бонусами за регистрацию",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "item": {
            "@type": "Service",
            "name": "Яндекс Доставка",
            "description": "Реферальная программа для курьеров Яндекс.Доставки",
            "url": "https://ya.cc/6a78dp"
          }
        },
        {
          "@type": "ListItem",
          "position": 2,
          "item": {
            "@type": "FinancialProduct",
            "name": "Tinkoff Black",
            "description": "Дебетовая карта с бонусом 500 рублей за оформление",
            "url": "https://www.tbank.ru/baf/95WeAzPonzu"
          }
        },
        {
          "@type": "ListItem",
          "position": 3,
          "item": {
            "@type": "JobPosting",
            "title": "Работа в Тинькофф",
            "description": "Вакансии в Тинькофф Банке с реферальным бонусом",
            "url": "https://www.tbank.ru/baf/9aTxF8fjnCK"
          }
        },
        {
          "@type": "ListItem",
          "position": 4,
          "item": {
            "@type": "MobileApplication",
            "name": "Тинькофф Мобайл",
            "description": "Мобильная связь от Тинькофф с бонусами",
            "url": "https://www.tbank.ru/baf/9OSldn7z9gr"
          }
        },
        {
          "@type": "ListItem",
          "position": 5,
          "item": {
            "@type": "Exchange",
            "name": "Криптобиржа ByBit",
            "description": "Торговая платформа для криптовалют с реферальной программой",
            "url": "https://www.bybit.com/invite?ref=OJ407B"
          }
        }
      ]
    }
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const filterButtons = document.querySelectorAll('.filter-btn');
      const cards = document.querySelectorAll('.ref-block');
      const categoryHeadings = document.querySelectorAll('.referral-buttons h2');
      
      // Восстановление выбранного фильтра из localStorage
      const savedFilter = localStorage.getItem('selectedFilter') || 'all';
      const activeBtn = document.querySelector(`.filter-btn[data-category="${savedFilter}"]`);
      if (activeBtn) {
        filterButtons.forEach(btn => btn.classList.remove('active'));
        activeBtn.classList.add('active');
        activeBtn.setAttribute('aria-pressed', 'true');
        filterCards(savedFilter);
      }

      // Анимация появления карточек
      function animateCards() {
        cards.forEach((card, index) => {
          card.style.animation = 'none';
          void card.offsetWidth; // Trigger reflow
          card.style.animation = `fadeInUp 0.5s forwards ${index * 0.1}s`;
        });
      }

      // Фильтрация карточек
      function filterCards(category) {
        // Сохраняем выбор в localStorage
        localStorage.setItem('selectedFilter', category);
        
        // Плавное скрытие/показ карточек
        cards.forEach(card => {
          const cardCategory = card.dataset.category;
          
          if (category === 'all' || cardCategory === category) {
            card.style.display = 'block';
          } else {
            card.style.display = 'none';
          }
        });
        
        // Обновляем заголовки категорий
        categoryHeadings.forEach(heading => {
          const headingCategory = heading.textContent.includes('доставке') ? 'доставка' : 
                               heading.textContent.includes('Банковские') ? 'банк' :
                               heading.textContent.includes('работ') ? 'работа' :
                               heading.textContent.includes('связь') ? 'связь' :
                               heading.textContent.includes('Крипто') ? 'крипта' : null;
          
          if (category === 'all' || headingCategory === category) {
            heading.style.display = 'block';
            heading.classList.add('category-anchor');
            
            // Прокрутка к первой видимой категории
            if (category !== 'all' && document.querySelector(`.filter-btn[data-category="${category}"]`)) {
              setTimeout(() => {
                heading.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
              }, 100);
            }
          } else {
            heading.style.display = 'none';
          }
        });
        
        // Запускаем анимацию для видимых карточек
        setTimeout(animateCards, 50);
      }

      // Обработчики для кнопок фильтра
      filterButtons.forEach(btn => {
        btn.addEventListener('click', function() {
          const category = this.dataset.category;
          
          // Обновляем состояние кнопок
          filterButtons.forEach(b => {
            b.classList.remove('active');
            b.setAttribute('aria-pressed', 'false');
          });
          
          this.classList.add('active');
          this.setAttribute('aria-pressed', 'true');
          
          // Фильтруем карточки
          filterCards(category);
        });
        
        // Инициализация ARIA-атрибутов
        btn.setAttribute('role', 'button');
        btn.setAttribute('aria-pressed', btn.classList.contains('active') ? 'true' : 'false');
      });

      // Инициализация анимации
      animateCards();
    });
  </script>
</section>
